# Story 1.3: Basic Command-Line Interface

## Status: Draft

## Story

As a user,
I want a simple command-line interface to enter calculations and see results,
so that I can easily use the calculator without complex setup.

## Acceptance Criteria

1. Interactive mode with clear input prompt
2. Real-time calculation display
3. Basic error messages for invalid input
4. Support for standard mathematical notation (+, -, *, /)
5. Clean output formatting
6. Exit command to terminate the application

## Context Source

- Source Document: docs/prd/epic-1-foundation-core-calculator.md
- Enhancement Type: User interface implementation
- Existing System Impact: First user-facing component

## Dev Notes

### Previous Story Insights

Story 1.2 implements the core calculation engine. This story builds the CLI interface that uses the calculation engine to provide interactive calculation capability.

### Data Models

No new data models required. Uses Calculation model from docs/architecture/data-models.md for storing calculation results if history is implemented later.

### API Specifications

Integrates with CalculationEngine interface from docs/architecture/components.md:

- Calculate(expression string) (float64, error)
- Validate(expression string) error

### Component Specifications

Implement basic CLI as simple REPL before full TUI. Following docs/architecture/frontend-architecture.md patterns but simplified:

- Use bufio.Scanner for input reading
- fmt for output formatting
- Basic error handling and display

Future stories will enhance to full Tview-based TUI.

### File Locations

Following unified project structure from docs/architecture/unified-project-structure.md:

- Main CLI: cmd/calculator/main.go (extend existing)
- CLI logic: internal/terminal/cli.go (new)
- Integration tests: test/integration/cli_test.go

### Testing Requirements

Follow testing strategy from docs/architecture/testing-strategy.md:

- Integration tests for CLI interaction
- Test input parsing and output formatting
- Test error handling scenarios
- E2E tests for complete CLI workflow

### Technical Constraints

- Use Go standard library (bufio, fmt) for basic CLI
- Follow coding standards from docs/architecture/coding-standards.md
- Error handling: user-friendly messages, no panics
- Input validation: basic expression format checking

## Tasks / Subtasks

- [ ] Extend cmd/calculator/main.go to support CLI mode
  - [ ] Add command-line flag for interactive mode
  - [ ] Initialize calculation engine
  - [ ] Start CLI loop or TUI based on flag

- [ ] Implement basic CLI REPL in internal/terminal/cli.go
  - [ ] Create CLI struct with scanner and engine
  - [ ] Implement input prompt display
  - [ ] Read user input with bufio.Scanner
  - [ ] Parse and validate expressions

- [ ] Integrate with calculation engine from Story 1.2
  - [ ] Call engine.Calculate() for valid expressions
  - [ ] Handle calculation errors gracefully
  - [ ] Display results with clean formatting

- [ ] Implement error handling and messages
  - [ ] Invalid input format errors
  - [ ] Calculation errors (division by zero, etc.)
  - [ ] User-friendly error messages
  - [ ] Continue operation after errors

- [ ] Add exit command functionality
  - [ ] Recognize "exit" or "quit" commands
  - [ ] Clean shutdown of application
  - [ ] Handle Ctrl+C gracefully

- [ ] Implement clean output formatting
  - [ ] Format numerical results appropriately
  - [ ] Clear prompts and result display
  - [ ] Handle large numbers and precision

- [ ] Create integration tests in test/integration/cli_test.go
  - [ ] Test basic calculation input/output
  - [ ] Test error scenarios
  - [ ] Test exit command
  - [ ] Test input validation

## Testing

- Integration tests: CLI interaction with calculation engine
- E2E tests: Complete user workflow from input to result display
- Edge cases: Invalid input, calculation errors, exit commands
- Follow testing examples from docs/architecture/testing-strategy.md

## Dev Agent Record

### Agent Model Used

SM (Scrum Master) - Story Preparation Specialist

### Debug Log References

- CLI implementation following frontend-architecture.md patterns
- Integration with calculation engine from Story 1.2
- Error handling and user experience considerations

### Completion Notes

- Basic CLI REPL implemented with interactive prompt
- Integration with calculation engine for real-time calculations
- Error handling with user-friendly messages
- Clean output formatting and exit functionality
- Integration tests covering user interaction scenarios

### File List

- cmd/calculator/main.go (modified)
- internal/terminal/cli.go (new)
- test/integration/cli_test.go (new)

### Change Log

- 2025-01-12: Initial story creation with CLI interface requirements and integration details

## Status: Draft